<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - UK Farms Map</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #2e7d32;
        }
        button {
            background-color: #2e7d32;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #1b5e20;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
        }
        .info {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ UK Farms Map - Debug Panel</h1>
        <p>–ü–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>

        <!-- API Configuration Test -->
        <div class="test-section">
            <h3>üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API</h3>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google Apps Script –∏ –≤–Ω–µ—à–Ω–∏–º API</p>
            <button onclick="testGoogleScript()">–¢–µ—Å—Ç Google Apps Script</button>
            <button onclick="testPostcodesAPI()">–¢–µ—Å—Ç Postcodes.io API</button>
            <div id="apiResult" class="result"></div>
        </div>

        <!-- Postcode Geocoding Test -->
        <div class="test-section">
            <h3>üìç –¢–µ—Å—Ç –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div class="form-group">
                <label for="testPostcode">UK Postcode:</label>
                <input type="text" id="testPostcode" value="SW1A 1AA" placeholder="–í–≤–µ–¥–∏—Ç–µ UK postcode">
            </div>
            <button onclick="testGeocoding()">–ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å</button>
            <div id="geocodeResult" class="result"></div>
        </div>

        <!-- Farm Data Test -->
        <div class="test-section">
            <h3>üè≠ –¢–µ—Å—Ç –¥–∞–Ω–Ω—ã—Ö —Ñ–µ—Ä–º</h3>
            <button onclick="testLoadFarms()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–µ—Ä–º—ã</button>
            <button onclick="testAddFarm()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ñ–µ—Ä–º—É</button>
            <div id="farmResult" class="result"></div>
        </div>

        <!-- Theme Test -->
        <div class="test-section">
            <h3>üé® –¢–µ—Å—Ç —Ç–µ–º</h3>
            <button onclick="testLightTheme()">–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞</button>
            <button onclick="testDarkTheme()">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</button>
            <button onclick="testAutoTheme()">–ê–≤—Ç–æ —Ç–µ–º–∞</button>
            <div id="themeResult" class="result"></div>
        </div>

        <!-- Notification Test -->
        <div class="test-section">
            <h3>üîî –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h3>
            <button onclick="testSuccessNotification()">–£—Å–ø–µ—Ö</button>
            <button onclick="testErrorNotification()">–û—à–∏–±–∫–∞</button>
            <button onclick="testInfoNotification()">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
            <div id="notificationResult" class="result"></div>
        </div>

        <!-- Local Storage Test -->
        <div class="test-section">
            <h3>üíæ –¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞</h3>
            <button onclick="testLocalStorage()">–¢–µ—Å—Ç localStorage</button>
            <button onclick="clearLocalStorage()">–û—á–∏—Å—Ç–∏—Ç—å localStorage</button>
            <div id="storageResult" class="result"></div>
        </div>

        <!-- Farm Name Autocomplete Test -->
        <div class="test-section">
            <h3>üîç –¢–µ—Å—Ç –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
            <div class="form-group">
                <label for="testFarmName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–µ—Ä–º—ã:</label>
                <input type="text" id="testFarmName" placeholder="–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–µ—Ä–º—ã">
            </div>
            <button onclick="testAutocomplete()">–¢–µ—Å—Ç –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è</button>
            <div id="autocompleteResult" class="result"></div>
        </div>

        <!-- Performance Test -->
        <div class="test-section">
            <h3>‚ö° –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h3>
            <button onclick="testPerformance()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
            <div id="performanceResult" class="result"></div>
        </div>
    </div>

    <!-- Include main app files for testing -->
    <script src="config.js"></script>
    
    <script>
        // Debug functions
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }

        async function testGoogleScript() {
            showResult('apiResult', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google Apps Script...', 'info');
            
            try {
                const response = await fetch(CONFIG.GOOGLE_SCRIPT_URL + '?action=GET_FARMS');
                const data = await response.json();
                
                if (data.success) {
                    showResult('apiResult', `‚úÖ Google Apps Script —Ä–∞–±–æ—Ç–∞–µ—Ç!\n–ü–æ–ª—É—á–µ–Ω–æ —Ñ–µ—Ä–º: ${data.data?.length || 0}`, 'success');
                } else {
                    showResult('apiResult', `‚ùå –û—à–∏–±–∫–∞ Google Apps Script: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult('apiResult', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        async function testPostcodesAPI() {
            showResult('apiResult', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Postcodes.io API...', 'info');
            
            try {
                const response = await fetch('https://api.postcodes.io/postcodes/SW1A1AA');
                const data = await response.json();
                
                if (data.status === 200) {
                    showResult('apiResult', `‚úÖ Postcodes.io API —Ä–∞–±–æ—Ç–∞–µ—Ç!\n–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${data.result.latitude}, ${data.result.longitude}`, 'success');
                } else {
                    showResult('apiResult', `‚ùå –û—à–∏–±–∫–∞ Postcodes.io: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult('apiResult', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Postcodes.io: ${error.message}`, 'error');
            }
        }

        async function testGeocoding() {
            const postcode = document.getElementById('testPostcode').value;
            if (!postcode) {
                showResult('geocodeResult', '‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å', 'error');
                return;
            }

            showResult('geocodeResult', `–ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ ${postcode}...`, 'info');
            
            try {
                const response = await fetch(`https://api.postcodes.io/postcodes/${encodeURIComponent(postcode)}`);
                const data = await response.json();
                
                if (data.status === 200) {
                    const result = `‚úÖ –£—Å–ø–µ—à–Ω–æ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–æ!
–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å: ${data.result.postcode}
–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${data.result.latitude}, ${data.result.longitude}
–†–µ–≥–∏–æ–Ω: ${data.result.region}
–°—Ç—Ä–∞–Ω–∞: ${data.result.country}`;
                    showResult('geocodeResult', result, 'success');
                } else {
                    showResult('geocodeResult', `‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult('geocodeResult', `‚ùå –û—à–∏–±–∫–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        async function testLoadFarms() {
            showResult('farmResult', '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–µ—Ä–º...', 'info');
            
            try {
                // Test with demo data first
                const demoFarms = [
                    { name: 'Test Farm 1', type: 'vegetables', lat: 52.3980, lng: 0.2620 },
                    { name: 'Test Farm 2', type: 'berries', lat: 51.2704, lng: 0.5227 }
                ];
                
                showResult('farmResult', `‚úÖ –î–µ–º–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–µ—Ä–º: ${demoFarms.length}`, 'success');
            } catch (error) {
                showResult('farmResult', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');
            }
        }

        async function testAddFarm() {
            showResult('farmResult', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–µ—Ä–º—ã...', 'info');
            
            const testFarm = {
                farmType: 'vegetables',
                farmName: 'Test Farm Debug',
                farmAddress: 'Test Address, London',
                farmPostcode: 'SW1A 1AA',
                farmOperator: 'AgriHR',
                farmRating: 4,
                farmComment: 'Test comment from debug panel',
                userEmail: 'test@gmail.com'
            };
            
            try {
                // Simulate API call
                showResult('farmResult', `‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–µ—Ä–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é!
–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(testFarm, null, 2)}`, 'success');
            } catch (error) {
                showResult('farmResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function testLightTheme() {
            document.documentElement.setAttribute('data-theme', 'light');
            showResult('themeResult', '‚úÖ –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞', 'success');
        }

        function testDarkTheme() {
            document.documentElement.setAttribute('data-theme', 'dark');
            showResult('themeResult', '‚úÖ –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞', 'success');
        }

        function testAutoTheme() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = prefersDark ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            showResult('themeResult', `‚úÖ –ê–≤—Ç–æ —Ç–µ–º–∞: ${theme}`, 'success');
        }

        function testSuccessNotification() {
            showResult('notificationResult', '‚úÖ –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ', 'success');
        }

        function testErrorNotification() {
            showResult('notificationResult', '‚ùå –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ', 'error');
        }

        function testInfoNotification() {
            showResult('notificationResult', '‚ÑπÔ∏è –¢–µ—Å—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', 'info');
        }

        function testLocalStorage() {
            try {
                // Test localStorage functionality
                localStorage.setItem('test_key', 'test_value');
                const value = localStorage.getItem('test_key');
                
                if (value === 'test_value') {
                    showResult('storageResult', '‚úÖ localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                } else {
                    showResult('storageResult', '‚ùå localStorage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
                }
            } catch (error) {
                showResult('storageResult', `‚ùå –û—à–∏–±–∫–∞ localStorage: ${error.message}`, 'error');
            }
        }

        function clearLocalStorage() {
            try {
                localStorage.clear();
                showResult('storageResult', '‚úÖ localStorage –æ—á–∏—â–µ–Ω', 'success');
            } catch (error) {
                showResult('storageResult', `‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: ${error.message}`, 'error');
            }
        }

        function testAutocomplete() {
            const input = document.getElementById('testFarmName').value;
            
            if (!input || input.length < 2) {
                showResult('autocompleteResult', '‚ùå –í–≤–µ–¥–∏—Ç–µ –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞', 'error');
                return;
            }
            
            const matches = CONFIG.FAMOUS_FARMS.filter(farm => 
                farm.toLowerCase().includes(input.toLowerCase())
            ).slice(0, 10);
            
            if (matches.length > 0) {
                showResult('autocompleteResult', `‚úÖ –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: ${matches.length}\n${matches.join('\n')}`, 'success');
            } else {
                showResult('autocompleteResult', '‚ùå –°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
            }
        }

        function testPerformance() {
            showResult('performanceResult', '–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...', 'info');
            
            const startTime = performance.now();
            
            // Test 1: Farm filtering
            const filterStart = performance.now();
            const testQuery = 'farm';
            const matches = CONFIG.FAMOUS_FARMS.filter(farm => 
                farm.toLowerCase().includes(testQuery.toLowerCase())
            );
            const filterTime = performance.now() - filterStart;
            
            // Test 2: DOM manipulation
            const domStart = performance.now();
            for (let i = 0; i < 100; i++) {
                const div = document.createElement('div');
                div.textContent = `Test ${i}`;
            }
            const domTime = performance.now() - domStart;
            
            const totalTime = performance.now() - startTime;
            
            const result = `‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!
–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–µ—Ä–º (${matches.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤): ${filterTime.toFixed(2)}ms
DOM –æ–ø–µ—Ä–∞—Ü–∏–∏ (100 —ç–ª–µ–º–µ–Ω—Ç–æ–≤): ${domTime.toFixed(2)}ms
–û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalTime.toFixed(2)}ms`;
            
            showResult('performanceResult', result, 'success');
        }

        // Initialize autocomplete test
        document.getElementById('testFarmName').addEventListener('input', function() {
            const value = this.value;
            if (value.length >= 2) {
                testAutocomplete();
            }
        });

        // Show initial info
        showResult('apiResult', '–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é API', 'info');
        showResult('geocodeResult', '–í–≤–µ–¥–∏—Ç–µ UK postcode –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'info');
        showResult('farmResult', '–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Ñ–µ—Ä–º', 'info');
        showResult('themeResult', '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'info');
        showResult('notificationResult', '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'info');
        showResult('storageResult', '–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é localStorage', 'info');
        showResult('autocompleteResult', '–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–µ—Ä–º—ã', 'info');
        showResult('performanceResult', '–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏', 'info');
    </script>
</body>
</html>