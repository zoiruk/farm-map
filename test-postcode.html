<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç UK Postcodes - UK Farms Map</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            background-color: #2e7d32;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background-color: #1b5e20;
        }
        .result-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .success {
            border-left: 4px solid #4caf50;
            background-color: #f1f8e9;
        }
        .error {
            border-left: 4px solid #f44336;
            background-color: #ffebee;
        }
        .postcode-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .info-item {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
        }
        .info-label {
            font-weight: 500;
            color: #666;
            font-size: 12px;
            text-transform: uppercase;
        }
        .info-value {
            font-size: 16px;
            color: #333;
            margin-top: 2px;
        }
        .sample-postcodes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .sample-postcode {
            background: #e3f2fd;
            padding: 8px 12px;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .sample-postcode:hover {
            background: #bbdefb;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2e7d32;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .stats {
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UK Postcodes</h1>
        <p>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –±—Ä–∏—Ç–∞–Ω—Å–∫–∏—Ö –ø–æ—á—Ç–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ —á–µ—Ä–µ–∑ Postcodes.io API</p>

        <!-- Statistics -->
        <div class="stats">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="successfulTests">0</div>
                    <div class="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="failedTests">0</div>
                    <div class="stat-label">–ù–µ—É–¥–∞—á–Ω—ã—Ö</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="avgResponseTime">0ms</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>
                </div>
            </div>
        </div>

        <!-- Test Form -->
        <div class="test-form">
            <h3>üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—á—Ç–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞</h3>
            <div class="form-group">
                <label for="postcodeInput">UK Postcode:</label>
                <input type="text" id="postcodeInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: SW1A 1AA" maxlength="8">
            </div>
            <button onclick="testSinglePostcode()">
                <span class="material-symbols-outlined">search</span>
                –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button onclick="testRandomPostcode()">
                <span class="material-symbols-outlined">shuffle</span>
                –°–ª—É—á–∞–π–Ω—ã–π
            </button>
            <button onclick="testAllSamples()">
                <span class="material-symbols-outlined">playlist_play</span>
                –¢–µ—Å—Ç –≤—Å–µ—Ö –æ–±—Ä–∞–∑—Ü–æ–≤
            </button>
            <button onclick="clearResults()">
                <span class="material-symbols-outlined">clear_all</span>
                –û—á–∏—Å—Ç–∏—Ç—å
            </button>
        </div>

        <!-- Sample Postcodes -->
        <div class="test-form">
            <h3>üìã –û–±—Ä–∞–∑—Ü—ã –ø–æ—á—Ç–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤</h3>
            <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π –ø–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</p>
            <div class="sample-postcodes" id="samplePostcodes">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Results -->
        <div id="results">
            <!-- Test results will appear here -->
        </div>
    </div>

    <script>
        // Sample UK postcodes for testing
        const SAMPLE_POSTCODES = [
            // London
            'SW1A 1AA', 'W1A 0AX', 'EC1A 1BB', 'N1 9GU', 'E1 6AN', 'SE1 9RT',
            'NW1 6XE', 'SW7 2AZ', 'WC2N 5DU', 'E14 5JP',
            
            // Major Cities
            'M1 1AA', 'B1 1AA', 'LS1 1AA', 'S1 1AA', 'NE1 1AA', 'L1 1AA',
            'BS1 1AA', 'CV1 1AA', 'NG1 1AA', 'DE1 1AA',
            
            // Scotland
            'EH1 1AA', 'G1 1AA', 'AB10 1AA', 'DD1 1AA', 'FK1 1AA',
            
            // Wales
            'CF10 1AA', 'SA1 1AA', 'LL11 1AA', 'NP20 1AA',
            
            // Northern Ireland
            'BT1 1AA', 'BT48 1AA',
            
            // Rural Areas
            'CA1 1AA', 'DL1 1AA', 'HG1 1AA', 'LA1 1AA', 'YO1 1AA',
            'TR1 1AA', 'PL1 1AA', 'EX1 1AA', 'BA1 1AA', 'SN1 1AA',
            
            // Agricultural Areas (relevant for farms)
            'PE1 1AA', 'CB1 1AA', 'IP1 1AA', 'NR1 1AA', 'LN1 1AA',
            'DN1 1AA', 'HU1 1AA', 'YO25 1AA', 'PE11 1AA', 'CB7 1AA'
        ];

        let testStats = {
            total: 0,
            successful: 0,
            failed: 0,
            responseTimes: []
        };

        // Initialize sample postcodes
        function initSamplePostcodes() {
            const container = document.getElementById('samplePostcodes');
            container.innerHTML = SAMPLE_POSTCODES.map(postcode => 
                `<div class="sample-postcode" onclick="testPostcode('${postcode}')">${postcode}</div>`
            ).join('');
        }

        // Test a single postcode
        async function testSinglePostcode() {
            const postcode = document.getElementById('postcodeInput').value.trim();
            if (!postcode) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å');
                return;
            }
            await testPostcode(postcode);
        }

        // Test a random postcode
        async function testRandomPostcode() {
            const randomPostcode = SAMPLE_POSTCODES[Math.floor(Math.random() * SAMPLE_POSTCODES.length)];
            document.getElementById('postcodeInput').value = randomPostcode;
            await testPostcode(randomPostcode);
        }

        // Test all sample postcodes
        async function testAllSamples() {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ ${SAMPLE_POSTCODES.length} –ø–æ—á—Ç–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤? –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.`)) {
                return;
            }

            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '<div class="result-card"><h3>üîÑ –ú–∞—Å—Å–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...</h3><div class="loading"></div></div>';

            for (let i = 0; i < SAMPLE_POSTCODES.length; i++) {
                const postcode = SAMPLE_POSTCODES[i];
                await testPostcode(postcode, false); // Don't scroll to result
                
                // Update progress
                const progress = Math.round(((i + 1) / SAMPLE_POSTCODES.length) * 100);
                document.querySelector('.result-card h3').textContent = `üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ... ${progress}% (${i + 1}/${SAMPLE_POSTCODES.length})`;
                
                // Small delay to prevent rate limiting
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            // Show completion message
            const completionCard = document.createElement('div');
            completionCard.className = 'result-card success';
            completionCard.innerHTML = `
                <h3>‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h3>
                <p>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ ${SAMPLE_POSTCODES.length} –ø–æ—á—Ç–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤</p>
            `;
            resultsContainer.insertBefore(completionCard, resultsContainer.firstChild);
        }

        // Main test function
        async function testPostcode(postcode, scrollToResult = true) {
            const startTime = performance.now();
            testStats.total++;

            // Create result card
            const resultCard = document.createElement('div');
            resultCard.className = 'result-card';
            resultCard.innerHTML = `
                <h3>üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${postcode}</h3>
                <div class="loading"></div>
            `;

            const resultsContainer = document.getElementById('results');
            resultsContainer.insertBefore(resultCard, resultsContainer.firstChild);

            if (scrollToResult) {
                resultCard.scrollIntoView({ behavior: 'smooth' });
            }

            try {
                const response = await fetch(`https://api.postcodes.io/postcodes/${encodeURIComponent(postcode)}`);
                const data = await response.json();
                const responseTime = performance.now() - startTime;
                testStats.responseTimes.push(responseTime);

                if (data.status === 200 && data.result) {
                    testStats.successful++;
                    resultCard.className = 'result-card success';
                    resultCard.innerHTML = createSuccessResult(postcode, data.result, responseTime);
                } else {
                    testStats.failed++;
                    resultCard.className = 'result-card error';
                    resultCard.innerHTML = createErrorResult(postcode, data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞', responseTime);
                }
            } catch (error) {
                const responseTime = performance.now() - startTime;
                testStats.failed++;
                resultCard.className = 'result-card error';
                resultCard.innerHTML = createErrorResult(postcode, error.message, responseTime);
            }

            updateStats();
        }

        // Create success result HTML
        function createSuccessResult(postcode, result, responseTime) {
            return `
                <h3>‚úÖ ${postcode} - –£—Å–ø–µ—à–Ω–æ</h3>
                <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> ${responseTime.toFixed(0)}ms</p>
                <div class="postcode-info">
                    <div class="info-item">
                        <div class="info-label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</div>
                        <div class="info-value">${result.latitude}, ${result.longitude}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–†–µ–≥–∏–æ–Ω</div>
                        <div class="info-value">${result.region || 'N/A'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–°—Ç—Ä–∞–Ω–∞</div>
                        <div class="info-value">${result.country}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥</div>
                        <div class="info-value">${result.admin_district || 'N/A'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–ü–∞—Ä–ª–∞–º–µ–Ω—Ç—Å–∫–∏–π –æ–∫—Ä—É–≥</div>
                        <div class="info-value">${result.parliamentary_constituency || 'N/A'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">–ö–∞—á–µ—Å—Ç–≤–æ</div>
                        <div class="info-value">${result.quality}</div>
                    </div>
                </div>
                <button onclick="showOnMap(${result.latitude}, ${result.longitude}, '${postcode}')" style="margin-top: 10px;">
                    <span class="material-symbols-outlined">map</span>
                    –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                </button>
            `;
        }

        // Create error result HTML
        function createErrorResult(postcode, error, responseTime) {
            return `
                <h3>‚ùå ${postcode} - –û—à–∏–±–∫–∞</h3>
                <p><strong>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:</strong> ${responseTime.toFixed(0)}ms</p>
                <p><strong>–û—à–∏–±–∫–∞:</strong> ${error}</p>
                <p><em>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–Ω–¥–µ–∫—Å, –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é</em></p>
            `;
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('successfulTests').textContent = testStats.successful;
            document.getElementById('failedTests').textContent = testStats.failed;
            
            if (testStats.responseTimes.length > 0) {
                const avgTime = testStats.responseTimes.reduce((a, b) => a + b, 0) / testStats.responseTimes.length;
                document.getElementById('avgResponseTime').textContent = Math.round(avgTime) + 'ms';
            }
        }

        // Show location on map (opens in new tab)
        function showOnMap(lat, lng, postcode) {
            const url = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}&zoom=15&layers=M`;
            window.open(url, '_blank');
        }

        // Clear all results
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testStats = {
                total: 0,
                successful: 0,
                failed: 0,
                responseTimes: []
            };
            updateStats();
        }

        // Auto-format postcode input
        document.getElementById('postcodeInput').addEventListener('input', function(e) {
            let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            
            // Add space before last 3 characters if length > 3
            if (value.length > 3) {
                value = value.slice(0, -3) + ' ' + value.slice(-3);
            }
            
            e.target.value = value;
        });

        // Enter key to test
        document.getElementById('postcodeInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testSinglePostcode();
            }
        });

        // Initialize
        initSamplePostcodes();
        updateStats();
    </script>
</body>
</html>